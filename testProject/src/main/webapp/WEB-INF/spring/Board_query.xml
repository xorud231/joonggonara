<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
	
<mapper namespace="board">
	<select id = "getBoardNo" resultType = "int">
		select board_no.nextval from dual
	</select>
	
	<insert id = "addBoard" parameterType = "board">
		insert into board (no, id, title, contents, regdate)
		values (#{no:INTEGER}, #{id:VARCHAR}, #{title:VARCHAR}, #{contents:VARCHAR}, sysdate)
	</insert>
	
	<update id = "updateBoard" parameterType = "board">
		update board set title = #{title:VARCHAR}, contents = #{contents:VARCHAR}, regdate = sysdate
		where no = #{no:INTEGER}
	</update>
	
	<delete id = "removeBoard" parameterType = "int">
		delete from board where no = #{no:INTEGER}
	</delete>
	
	<select id = "searchBoard" parameterType = "int" resultType = "board">
		select no, id, title, contents, to_char(regdate, 'yyyy-mm-dd') regdate
		from board
		where no = #{no:INTEGER}
	</select>
	
	<select id = "getCount" parameterType = "pagebean" resultType = "int">
		select count(*)
		from board
		<where>
			<if test = "word != null">
				<choose>
					<when test = "key == 'title'">
						title like '%'||#{word}||'%'
					</when>
					<when test = "key == 'id'">
						id = #{word}
					</when>
					<when test = "key == 'contents'">
						contents like '%'||#{word}||'%'
					</when>
				</choose>
			</if>
		</where>
	</select>
	
	<select id = "searchAllBoard" parameterType = "pagebean" resultType = "board">
		select no, id, title, contents, to_char(regdate, 'yyyy-mm-dd') regdate
		from board
		<where>
			<if test = "word != null">
				<choose>
					<when test = "key == 'title'">
						title like '%'||#{word}||'%'
					</when>
					<when test = "key == 'id'">
						id = #{word}
					</when>
					<when test = "key == 'contents'">
						contents like '%'||#{word}||'%'
					</when>
				</choose>
			</if>
		</where>
		order by no desc
	</select>
	
	<select id = "getBuyCount" parameterType = "pagebean" resultType = "int">
		select count(*)
		from BUYBOARD
		<where>
			<if test = "word != null">
				<choose>
					<when test = "key == 'title'">
						title like '%'||#{word}||'%'
					</when>
					<when test = "key == 'id'">
						id = #{word}
					</when>
					<when test = "key == 'contents'">
						contents like '%'||#{word}||'%'
					</when>
				</choose>
			</if>
		</where>
	</select>
	<select id = "getSellCount" parameterType = "pagebean" resultType = "int">
		select count(*)
		from SELLBOARD
		<where>
			<if test = "word != null">
				<choose>
					<when test = "key == 'title'">
						title like '%'||#{word}||'%'
					</when>
					<when test = "key == 'id'">
						id = #{word}
					</when>
					<when test = "key == 'contents'">
						contents like '%'||#{word}||'%'
					</when>
				</choose>
			</if>
		</where>
	</select>
	<select id = "searchBuyList" parameterType = "pagebean" resultType = "board">
		select b.bno bno, b.title title, B.CONTENTS contents,b.price price, to_char(regdate, 'yyyy-mm-dd') regdate, bf.RFILENAME rfilename 
		from BUYBOARD b, BUYBOARDFILE bf
<<<<<<< HEAD
        where b.BNO = bf.BNO(+)
=======
        where b.bNO = bf.bNO(+)
        order by b.bno DESC
	</select>
	
	<select id = "searchSellList" parameterType = "pagebean" resultType = "board">
		select b.bno bno, b.title title, B.CONTENTS contents,b.price price, to_char(regdate, 'yyyy-mm-dd') regdate, bf.RFILENAME rfilename 
		from SELLBOARD b, SELLBOARDFILE bf
        where b.bNO = bf.bNO(+)
>>>>>>> branch 'master' of https://github.com/xorud231/joonggonara.git
        order by b.bno DESC
	</select>
	
	<select id = "searchBuyBoard" parameterType = "int" resultType = "board">
		select bno, price, dealstate, mno, dno, title, contents, to_char(regdate, 'yyyy-mm-dd') regdate
		from buyboard
		where bno = #{bno:INTEGER}
	</select>
	
	<select id = "searchSellBoard" parameterType = "int" resultType = "board">
		select bno, price, dealstate, mno, dno, title, contents, to_char(regdate, 'yyyy-mm-dd') regdate
		from sellboard
		where bno = #{bno:INTEGER}
	</select>
	
	<select id = "searchBuyReply" parameterType = "int" resultType = "reply">
		select *
		from buyreply
		where bno = #{bno:INTEGER}
	</select>
	
	<select id = "searchSellReply" parameterType = "int" resultType = "reply">
		select *
		from sellreply
		where bno = #{bno:INTEGER}
	</select>
	
	<select id = "getCountBuyReply" parameterType = "int" resultType = "int">
		select count(*)
		from buyreply
		where bno = #{bno:INTEGER}
	</select>
	
	<select id = "getCountSellReply" parameterType = "int" resultType = "int">
		select count(*)
		from sellreply
		where bno = #{bno:INTEGER}
	</select>
	
	<insert id = "insertBuyReply" parameterType = "hashmap">
		insert into BuyReply values (2, #{replycontent:VARCHAR}, #{bno:INTEGER}, sysdate, #{mno:INTEGER})
	</insert>
	
	<insert id = "insertSellReply" parameterType = "hashmap">
		insert into SellReply values (2, #{replycontent:VARCHAR}, #{bno:INTEGER}, sysdate, #{mno:INTEGER})
	</insert>
	
	<select id = "searchInCart" parameterType = "hashmap" resultType = "int">
		select count(*)
		from cart
		where mno = ${mno} and bno = ${bno} and bkind = ${sellbuy}
	</select>
	
	<delete id = "deleteCart" parameterType = "hashmap">
		delete from cart where mno = ${mno} and bno = ${bno} and bkind = ${sellbuy}
	</delete>
	
	<insert id = "insertCart" parameterType = "hashmap">
		insert into cart values (${mno}, ${bno}, ${sellbuy})
	</insert>
</mapper>
